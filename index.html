<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2360N0LQEQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2360N0LQEQ');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUYETF - ë‹¹ì‹ ì˜ íˆ¬ì ë‚˜ì¹¨ë°˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gmarket+Sans:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <style>
        :root { --bg-color: #0f1012; --card-bg: #1c1c1e; --text-main: #f2f4f6; --text-sub: #9ca3af; --border: #2c2c2e; --point: #3182f6; }
        body.light-mode { --bg-color: #f2f4f6; --card-bg: #ffffff; --text-main: #191f28; --text-sub: #4e5968; --border: #e5e8eb; }

        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); color: var(--text-main); transition: all 0.4s ease; scroll-behavior: smooth; }
        .logo-text { font-family: 'Gmarket Sans', sans-serif; font-size: 2rem; font-weight: 700; letter-spacing: -0.05em; }
        .hero-title { font-family: 'Gmarket Sans', sans-serif; font-weight: 700; font-size: 3.2rem; line-height: 1.3; letter-spacing: -0.02em; word-break: keep-all; }
        .info-card { background: var(--card-bg); border-radius: 32px; padding: 2.5rem; border: 1px solid var(--border); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; }
        .info-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); border-color: var(--point); }
        .nav-link { font-size: 1rem; font-weight: 600; color: var(--text-sub); transition: all 0.3s; position: relative; padding: 0.5rem 0; cursor: pointer; border: none; background: none; }
        .nav-link.active { color: var(--point); }
        .nav-link.active::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 100%; height: 2px; background: var(--point); transform: translateX(-50%); }
        .gradient-text { background: linear-gradient(135deg, #3182f6, #60a5fa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .market-detail-section { display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .etf-pill { background: var(--card-bg); border: 1px solid var(--border); padding: 1.5rem; border-radius: 24px; cursor: grab; transition: 0.3s; }
        .etf-pill:active { cursor: grabbing; opacity: 0.5; }
        .etf-pill:hover { border-color: var(--point); transform: translateY(-4px); }

        .portfolio-aside { position: sticky; top: 120px; height: fit-content; }
        .portfolio-window { background: #1c1c1e; border: 2px dashed #3182f6; border-radius: 32px; padding: 2rem; min-height: 400px; display: flex; flex-direction: column; }
        .portfolio-window.drag-over { background: rgba(49, 130, 246, 0.1); border-style: solid; }
        
        .selected-item { background: #2c2c2e; border-radius: 20px; padding: 1.25rem; margin-bottom: 0.75rem; border: 1px solid #3e3e42; }
        .weight-slider { -webkit-appearance: none; width: 100%; height: 4px; background: #3e3e42; border-radius: 2px; outline: none; }
        .weight-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: #3182f6; border-radius: 50%; cursor: pointer; border: 2px solid #fff; }

        .modal-overlay { backdrop-filter: blur(12px); background: rgba(0,0,0,0.8); display: none; position: fixed; inset: 0; align-items: center; justify-content: center; z-index: 500; padding: 20px; }
        .login-input { background: #2c2c2e; border: 1px solid #3e3e42; border-radius: 16px; padding: 1rem; width: 100%; color: white; outline: none; transition: border-color 0.3s; }
        .login-input:focus { border-color: #3182f6; }
        
        .result-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        .result-table td { padding: 16px; background: #2c2c2e; }
        .result-table tr td:first-child { border-radius: 16px 0 0 16px; color: #9ca3af; font-size: 0.875rem; }
        .result-table tr td:last-child { border-radius: 0 16px 16px 0; text-align: right; font-weight: 700; color: #3182f6; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="antialiased">

    <nav class="flex justify-between items-center px-8 py-6 sticky top-0 bg-inherit/90 backdrop-blur-xl z-[100] border-b border-gray-800/50">
        <div class="flex items-center gap-12">
            <div class="logo-text cursor-pointer hover:opacity-80 transition-opacity" onclick="location.reload()">
                <span class="text-[#3182f6]">BUY</span><span>ETF</span>
            </div>
            <div class="hidden md:flex gap-8">
                <button onclick="loadMarketData(this)" class="nav-link">MARKET</button>
                <button onclick="loadDividendData(this)" class="nav-link">DIVIDEND</button>
                
                <button onclick="showTrend('NEW')" class="nav-link">NEW</button>
                <button onclick="showTrend('HOT')" class="nav-link">HOT</button>
                
                <button onclick="loadData('í¬íŠ¸í´ë¦¬ì˜¤', this)" class="nav-link">í¬íŠ¸í´ë¦¬ì˜¤</button>
            </div>
        </div>
        <div class="flex items-center gap-5">
            <button onclick="toggleTheme()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-gray-800/50">ğŸŒ™</button>
            <div id="authArea">
                <button onclick="openLoginModal()" class="bg-[#3182f6] text-white px-6 py-2.5 rounded-xl text-sm font-bold active:scale-95 transition-transform">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-16">
        <div id="contentArea" class="space-y-24">
            <section class="text-center space-y-8 py-10">
                <h1 class="hero-title">ë‹¹ì‹ ì˜ íˆ¬ìì„±í–¥ì— ë§ëŠ” ETFë¥¼<br><span class="gradient-text">ì§ê´€ì ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</span></h1>
                <p class="text-lg text-[var(--text-sub)] max-w-lg mx-auto leading-relaxed">ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìµœì ì˜ í¬íŠ¸í´ë¦¬ì˜¤ ì„¤ê³„ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</p>
                <div class="pt-6">
                    <button onclick="loadData('í¬íŠ¸í´ë¦¬ì˜¤')" class="bg-[#3182f6] text-white px-10 py-4 rounded-full font-bold text-lg hover:scale-105 transition-transform shadow-lg shadow-blue-500/20">í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±í•˜ê¸°</button>
                </div>
            </section>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="info-card"><div class="text-2xl mb-6">ğŸ§­</div><h3 class="text-xl font-bold mb-3">ììœ ë¡œìš´ íƒìƒ‰</h3><p class="text-sm text-[var(--text-sub)]">ì‹œì¥ì˜ íë¦„ì„ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ì œí•˜ì—¬ ë‹¹ì‹ ì´ ì›í•˜ëŠ” ì¢…ëª©ì„ ë¹ ë¥´ê²Œ ë°œê²¬í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤.</p></div>
                <div class="info-card"><div class="text-2xl mb-6">ğŸ“Š</div><h3 class="text-xl font-bold mb-3">ë°ì´í„° ê¸°ë°˜ ì„¤ê³„</h3><p class="text-sm text-[var(--text-sub)]">ê³¼ê±° ë°ì´í„°ì™€ ì‹¤ì‹œê°„ ì§€í‘œë¥¼ ê²°í•©í•˜ì—¬ êµ¬ì„± ì¤‘ì¸ ìì‚°ì˜ ê¸°ëŒ€ ìˆ˜ìµì„ ì¦‰ì‹œ í™•ì¸í•©ë‹ˆë‹¤.</p></div>
                <div class="info-card"><div class="text-2xl mb-6">ğŸš€</div><h3 class="text-xl font-bold mb-3">ì „ëµì  ì‹œë®¬ë ˆì´ì…˜</h3><p class="text-sm text-[var(--text-sub)]">ë‹¤ì–‘í•œ ETFë¥¼ ë‹´ì•„ë³´ë©° ë‹¹ì‹ ì˜ íˆ¬ì ì² í•™ì´ ë‹´ê¸´ ì™„ë²½í•œ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì™„ì„±í•˜ì„¸ìš”.</p></div>
            </div>
        </div>

        <div id="dynamicContainer" class="hidden">
            <div class="flex flex-col lg:flex-row gap-12">
                <div class="flex-1">
                    <h2 id="sectionTitle" class="text-4xl font-bold mb-10 tracking-tight">Market Categories</h2>
                    <div id="etfGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    <div id="marketDetailArea" class="mt-20 market-detail-section">
                        <div class="flex items-center justify-between mb-8 border-b border-gray-800 pb-6">
                            <h3 id="selectedCatTitle" class="text-2xl font-bold text-[#3182f6]">Sector</h3>
                            <button onclick="closeMarketDetail()" class="text-sm font-bold text-gray-500 hover:text-white">ë‹«ê¸° âœ•</button>
                        </div>
                        <div id="marketEtfGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                    </div>
                </div>

                <aside id="portfolioSidebar" class="hidden w-full lg:w-[400px] portfolio-aside">
                    <div id="dropZone" class="portfolio-window" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                        <div class="flex flex-col items-center mb-8">
                            <div id="portfolioUserIcon" class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mb-3">ğŸ‘¤</div>
                            <h3 id="portfolioUserName" class="font-bold text-xl">ë‚´ íˆ¬ì ì¡°í•©</h3>
                            <p class="text-sm text-gray-500 mt-1">ETFë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë¹„ì¤‘ì„ ì¡°ì ˆí•˜ì„¸ìš”</p>
                        </div>
                        <div id="portfolioList" class="flex-1">
                            <div id="emptyMessage" class="h-40 flex items-center justify-center text-gray-600 border border-dashed border-gray-800 rounded-2xl">ë¹„ì–´ ìˆìŒ</div>
                        </div>
                        <div id="weightWarning" class="text-[11px] text-red-400 text-center mb-2 hidden font-bold">ë¹„ì¤‘ì˜ í•©ì´ 100%ê°€ ì•„ë‹™ë‹ˆë‹¤</div>
                        <button onclick="showFinalAnalysis()" class="w-full bg-[#3182f6] text-white py-5 rounded-2xl font-bold mt-4 hover:bg-blue-600 transition-all shadow-xl shadow-blue-500/20 active:scale-95">ê²°ê³¼ ë³´ê¸°</button>
                    <p class="mt-4 text-xs text-gray-500 text-center leading-relaxed">
  â€» ìˆ˜ìµë¥ ì€ ì „ì¼ ì¢…ê°€ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì¶œë˜ë©°,<br>
  ì‹¤ì‹œê°„ ì²´ê²°ê°€(ë„¤ì´ë²„ ì¦ê¶Œ ë“±)ì™€ ì°¨ì´ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</p>

                    </div>
                </aside>
            </div>
        </div>
    </main>

    <div id="loginModal" class="modal-overlay">
        <div class="bg-[#1c1c1e] p-10 rounded-[40px] max-w-sm w-full border border-[#2c2c2e] text-center shadow-2xl">
            <div class="logo-text mb-8"><span class="text-[#3182f6]">BUY</span><span>ETF</span></div>
            <div class="space-y-4 mb-8">
                <input type="text" id="loginEmail" placeholder="ì´ë©”ì¼" class="login-input">
                <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="login-input">
            </div>
            <button onclick="handleFakeLogin()" class="w-full bg-[#3182f6] py-4 rounded-2xl font-bold text-white hover:bg-blue-600 mb-6 active:scale-95 transition-all">ë¡œê·¸ì¸</button>
            <div class="text-gray-500 text-xs flex items-center justify-center gap-4 mb-8">
                
            </div>
            <div class="border-t border-gray-800 pt-8 space-y-3">
                <button class="w-full bg-white text-black py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2">
                    
                </button>
            </div>
            <button onclick="closeModal('loginModal')" class="mt-6 text-gray-600 text-xs">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="analysisModal" class="modal-overlay">
        <div class="bg-[#1c1c1e] p-10 rounded-[40px] max-w-md w-full border border-[#3182f6] shadow-2xl shadow-blue-500/10 text-center">
            <div class="w-20 h-20 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-6"><span class="text-4xl">ğŸ¤–</span></div>
            <h3 class="text-2xl font-bold text-white mb-2">AI í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„</h3>
            <p class="text-gray-500 text-sm mb-8">ì„ íƒí•˜ì‹  ë¹„ì¤‘ì„ ë°”íƒ•ìœ¼ë¡œ ì‚°ì¶œëœ ë¯¸ë˜ ì¶”ì •ì¹˜ì…ë‹ˆë‹¤.</p>
            <div class="mb-8">
                <table class="result-table">
                    <tr><td>3ê°œì›” í›„ ì˜ˆìƒ ìˆ˜ìµë¥ </td><td id="ai3m">+0.00%</td></tr>
                    <tr><td>6ê°œì›” í›„ ì˜ˆìƒ ìˆ˜ìµë¥ </td><td id="ai6m">+0.00%</td></tr>
                    <tr><td>12ê°œì›” í›„ ì˜ˆìƒ ìˆ˜ìµë¥ </td><td id="ai12m" class="text-2xl text-[#3182f6]">+0.00%</td></tr>
                </table>
            </div>
            <div class="flex justify-between items-center bg-[#2c2c2e] p-4 rounded-2xl mb-8">
                <span class="text-gray-400 text-sm">í˜„ì¬ ê°€ì¤‘ ìˆ˜ìµë¥ </span>
                <span id="resYield" class="font-black text-xl text-white">0.00%</span>
            </div>
            <button onclick="closeModal('analysisModal')" class="w-full bg-[#3182f6] py-4 rounded-2xl font-bold text-white hover:bg-blue-600 transition-all active:scale-95">ë¶„ì„ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="etfDetailModal" class="modal-overlay" style="display: none; z-index: 9999;" onclick="if(event.target === this) closeModal('etfDetailModal')">
        <div class="bg-[#1c1c1e] p-10 rounded-[40px] max-w-sm w-full border border-gray-800 text-center shadow-2xl relative" onclick="event.stopPropagation()">
            <div id="modalLoading" class="absolute inset-0 bg-[#1c1c1e]/90 rounded-[40px] flex items-center justify-center z-20" style="display:none;">
                <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <div class="text-4xl mb-4">ğŸ“ˆ</div>
            <h3 id="detailTicker" class="text-3xl font-black text-white mb-1">-</h3>
            <div style="width: 100%; height: 200px; margin-bottom: 20px;">
                <canvas id="etfChart"></canvas>
            </div>
            <p class="text-gray-500 text-xs mb-8 uppercase font-bold tracking-widest"></p>
            <div class="space-y-3 mb-8">
                <div class="flex justify-between items-center bg-[#2c2c2e] p-4 rounded-2xl"><span class="text-gray-400 text-xs">1ê°œì›”</span><span id="m1" class="font-bold">-</span></div>
                <div class="flex justify-between items-center bg-[#2c2c2e] p-4 rounded-2xl"><span class="text-gray-400 text-xs">3ê°œì›”</span><span id="m3" class="font-bold">-</span></div>
                <div class="flex justify-between items-center bg-[#2c2c2e] p-4 rounded-2xl"><span class="text-gray-400 text-xs">6ê°œì›”</span><span id="m6" class="font-bold">-</span></div>
                <div class="flex justify-between items-center bg-[#2c2c2e] p-4 rounded-2xl"><span class="text-gray-400 text-xs">12ê°œì›”</span><span id="m12" class="font-black text-lg">-</span></div>
            </div>
            <button onclick="closeModal('etfDetailModal')" class="w-full bg-[#3182f6] py-4 rounded-2xl font-bold text-white">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        let myPortfolio = [];
        const tickerYields = {};
        // 1. ë°°ë‹¹ìˆ˜ìµë¥ ì„ ë‹´ì•„ë‘˜ ì‚¬ë¬¼í•¨
        const tickerDividends = {};
        let isLogged = false;

        // ì¹´í…Œê³ ë¦¬ë³„ ë§¤í•‘ë  ì‹¤ì œ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸
      // [ê·¹ëŒ€í™” ë²„ì „] ì¹´í…Œê³ ë¦¬ë³„ ë§¤í•‘ë  ì‹¤ì œ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸
      // [ê·¹ëŒ€í™” ë²„ì „] ì¹´í…Œê³ ë¦¬ë³„ ë§¤í•‘ë  ì‹¤ì œ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸
      const CATEGORY_MAP = {
    // [Market Wide] ë¯¸êµ­ ë° ê¸€ë¡œë²Œ ì „ì²´ ì§€ìˆ˜ (40ê°œ)
    "Market Wide": [
        "VTI", "VOO", "SPY", "QQQ", "DIA", "IWM", "QQQM", "IVV", "SPLG", "ITOT", 
        "VTWO", "UPRO", "TQQQ", "QLD", "SSO", "UDOW", "IJR", "SCHX", "VT", "VXUS",
        "VIG", "VV", "IWB", "IWF", "IWD", "VUG", "VTV", "SCHG", "SCHV", "IWR",
        "IJH", "MDY", "VO", "VB", "IJS", "VIOO", "IVE", "IVW", "SPYG", "SPYV"
    ],
    // [Sector] ë°˜ë„ì²´, IT, í—¬ìŠ¤ì¼€ì–´, ê¸ˆìœµ ë“± (40ê°œ)
    "Sector": [
        "XLK", "XLV", "XLF", "XLE", "XLI", "XLP", "XLU", "XLB", "XLC", "VGT", 
        "VHT", "VFH", "VDE", "FTEC", "IBB", "XBI", "KRE", "KBE", "OIH", "XOP",
        "SMH", "SOXX", "SOXL", "SOXS", "IGV", "PSI", "XRT", "XHB", "ITB", "VNQ",
        "IYR", "XLRE", "REM", "XLF", "KIE", "IAI", "IYG", "VPU", "IDU", "IYK"
    ],
    // [Style] ê³ ë°°ë‹¹, ë°°ë‹¹ì„±ì¥, í€„ë¦¬í‹° (40ê°œ)
    "Style": [
        "SCHD", "JEPI", "JEPQ", "VYM", "VIG", "DGRW", "DGRO", "NOBL", "COWZ", "QUAL",
        "VUG", "VTV", "MGK", "MGV", "IWF", "IWD", "XYLD", "QYLD", "USMV", "SPLV",
        "HDV", "DVY", "SDY", "SPYD", "RDIV", "FVD", "KNG", "REGL", "PEY", "SMDV",
        "MTUM", "VLUE", "SIZE", "IJK", "IJJ", "IJS", "IJT", "VIOO", "VIOG", "VIOV"
    ],
    // [Theme] AI, ë¡œë´‡, ìš°ì£¼, 2ì°¨ì „ì§€, ë³´ì•ˆ (40ê°œ)
    "Theme": [
        "SOXX", "AIQ", "ARKK", "LIT", "BOTZ", "CIBR", "SMH", "SOXL", "ROBO", "ARKW",
        "ARKG", "DRIV", "KARS", "SKYY", "CLOU", "HACK", "ITA", "PPA", "ROKT", "UFO",
        "HERO", "ESPO", "GAMR", "NERD", "MJ", "MSOS", "YOLO", "ICLN", "TAN", "FAN",
        "PBW", "PAVE", "IFRA", "XLI", "PHO", "FIW", "GIGE", "IPAY", "FINX", "METV"
    ],
    // [Defense] êµ­ì±„, ë‹¨ê¸°ì±„, ê¸ˆ, ì€, ì›ìì¬ (40ê°œ)
    "Defense": [
        "BND", "TLT", "SGOV", "TIP", "GLD", "LQD", "BIL", "ICSH", "AGG", "BNDX",
        "SHV", "VGSH", "VGIT", "VGLT", "BNDW", "MUB", "HYG", "JNK", "PFF", "PGX",
        "IAU", "SLV", "GLDM", "DBC", "GSG", "USO", "UNG", "DBA", "DBB", "DBP",
        "SHY", "IEF", "TLH", "EDV", "ZROZ", "GOVT", "MBB", "VCIT", "VCSH", "VGLT"
    ],
    // [Dividend Categories] ë°°ë‹¹ ì£¼ê¸°ë³„ (ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ í™•ì¥)
    "Monthly": ["JEPI", "JEPQ", "QYLD", "XYLD", "O", "MAIN", "STAG", "ADC", "DHS", "DLN", "DON", "SRET", "PFF", "PGX", "TLTW", "HYGW", "DIV", "SDIV", "ALTY", "RYLD"],
    "Quarterly": ["SCHD", "VYM", "VIG", "DGRO", "SDY", "DVY", "HDV", "NOBL", "RDIV", "SPYD", "DGRW", "VYMI", "IDV", "FVD", "KNG", "REGL", "SMDV", "TDIV", "PEY", "SPYV"],
    "Semi-Annual": ["VEU", "VWO", "VSS", "IDV", "EFA", "EEM", "IEFA", "EFV", "IXUS", "SCZ", "AIA", "VIGI", "PID", "DEM", "DGS", "DOO", "HILO", "EUMV", "EELV", "ACWI"],
    "Annual": ["VXUS", "BNDX", "VTI", "ITOT", "VT", "VOO", "SPY", "QQQ", "DIA", "BND", "AGG", "LQD", "VCIT", "VCSH", "BSV", "BIV", "BLV", "VGIT", "VGSH", "VGLT"]
};

       // [ìˆ˜ì •] ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì¹´ë“œ í‘œì‹œ í…ìŠ¤íŠ¸ í™•ì¥
        function loadMarketData(btn) {
            switchView(true); updateNav(btn);
            document.getElementById('sectionTitle').innerText = "Market Categories";
            document.getElementById('portfolioSidebar').classList.add('hidden');
            const categories = [
                { cat: "Market Wide", etf: "VTI, VOO, QQQ, TQQQ, IWM ì™¸ 30ì¢…", desc: "ë¯¸êµ­ ë° ê¸€ë¡œë²Œ ì§€ìˆ˜ ì¶”ì¢… ìƒí’ˆ", color: "blue" },
                { cat: "Sector", etf: "XLK, XLV, SMH, XLE, XBI ì™¸ 40ì¢…", desc: "ë°˜ë„ì²´, IT, í—¬ìŠ¤ì¼€ì–´ ë“± ì‚°ì—…êµ°ë³„ íˆ¬ì", color: "purple" },
                { cat: "Style", etf: "SCHD, JEPI, VUG, DGRO ì™¸ 40ì¢…", desc: "ê³ ë°°ë‹¹, ì„±ì¥ì£¼, ê°€ì¹˜ì£¼ ë“± íˆ¬ì ì „ëµ", color: "orange" },
                { cat: "Theme", etf: "SOXX, AIQ, ARKK, LIT, ITA ì™¸ 40ì¢…", desc: "AI, ìš°ì£¼í•­ê³µ, 2ì°¨ì „ì§€ ë“± ë¯¸ë˜ í˜ì‹  í…Œë§ˆ", color: "green" },
                { cat: "Defense", etf: "BND, TLT, SGOV, GLD, IAU ì™¸ 40ì¢…", desc: "êµ­ì±„, ê¸ˆ, ì›ìì¬ ë“± ì•ˆì „ ìì‚° ë° í—¤ì§€", color: "gray" }
            ];
            document.getElementById('etfGrid').innerHTML = categories.map(item => `<div class="info-card !p-8 cursor-pointer" onclick="showMarketDetail('${item.cat}')"><span class="text-[10px] font-bold text-white bg-${item.color}-500 px-2.5 py-1 rounded-lg uppercase">${item.cat}</span><h3 class="text-2xl font-black mt-5">${item.etf}</h3><p class="text-sm text-[var(--text-sub)] mt-3">${item.desc}</p></div>`).join('');
        }
        function loadDividendData(btn) {
            switchView(true); 
            updateNav(btn);
            document.getElementById('sectionTitle').innerText = "Dividend Strategy";
            document.getElementById('portfolioSidebar').classList.add('hidden');
            
            const categories = [
                { cat: "Monthly", etf: "JEPI, JEPQ, O...", desc: "ë§¤ë‹¬ ì›”ê¸‰ì²˜ëŸ¼ ë°›ëŠ” ì›”ê°„ ë°°ë‹¹", color: "red" },
                { cat: "Quarterly", etf: "SCHD, VIG, VYM...", desc: "3ê°œì›”ë§ˆë‹¤ ì§€ê¸‰ë˜ëŠ” ì•ˆì •ì  ë¶„ê¸° ë°°ë‹¹", color: "blue" },
                { cat: "Semi-Annual", etf: "VEU, VWO, IDV...", desc: "6ê°œì›” ë‹¨ìœ„ì˜ ê¸€ë¡œë²Œ/êµ­ì œ ë°°ë‹¹", color: "yellow" },
                { cat: "Annual", etf: "VXUS, BNDX...", desc: "1ë…„ì— í•œ ë²ˆ ì§€ê¸‰ë˜ëŠ” ì •ê¸° ë°°ë‹¹", color: "indigo" }
            ];
            
            document.getElementById('etfGrid').innerHTML = categories.map(item => `
                <div class="info-card !p-8 cursor-pointer" onclick="showMarketDetail('${item.cat}')">
                    <span class="text-[10px] font-bold text-white bg-${item.color}-500 px-2.5 py-1 rounded-lg uppercase">${item.cat}</span>
                    <h3 class="text-2xl font-black mt-5">${item.etf}</h3>
                    <p class="text-sm text-[var(--text-sub)] mt-3">${item.desc}</p>
                </div>
            `).join('');
        }

        // [ìˆ˜ì •] ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì¹´ë“œ í‘œì‹œ í…ìŠ¤íŠ¸ í™•ì¥ (loadMarketData í•¨ìˆ˜ ë‚´ë¶€)
        function loadMarketData(btn) {
            switchView(true); updateNav(btn);
            document.getElementById('sectionTitle').innerText = "Market Categories";
            document.getElementById('portfolioSidebar').classList.add('hidden');
            const categories = [
                { cat: "Market Wide", etf: "VOO, QQQ, SPY, IWM...", desc: "S&P500, ë‚˜ìŠ¤ë‹¥ ë“± ì „ì²´ ì§€ìˆ˜ ì¶”ì¢…", color: "blue" },
                { cat: "Sector", etf: "XLK, XLV, XLE, VGT...", desc: "IT, ë°”ì´ì˜¤, ì—ë„ˆì§€, ê¸ˆìœµ ì„¹í„°", color: "purple" },
                { cat: "Style", etf: "SCHD, VUG, JEPI, VTV...", desc: "ì„±ì¥, ê°€ì¹˜, ê³ ë°°ë‹¹ ì „ëµ ìƒí’ˆ", color: "orange" },
                { cat: "Theme", etf: "SOXX, SMH, AIQ, ARKK...", desc: "ë°˜ë„ì²´, AI, 2ì°¨ì „ì§€ ë“± í˜ì‹  ê¸°ìˆ ", color: "green" },
                { cat: "Defense", etf: "BND, TLT, SGOV, GLD...", desc: "ì•ˆì •ì ì¸ êµ­ì±„, ê¸ˆ, í˜„ê¸ˆì„± ìì‚°", color: "gray" }
            ];
            document.getElementById('etfGrid').innerHTML = categories.map(item => `<div class="info-card !p-8 cursor-pointer" onclick="showMarketDetail('${item.cat}')"><span class="text-[10px] font-bold text-white bg-${item.color}-500 px-2.5 py-1 rounded-lg uppercase">${item.cat}</span><h3 class="text-2xl font-black mt-5">${item.etf}</h3><p class="text-sm text-[var(--text-sub)] mt-3">${item.desc}</p></div>`).join('');
        }

        function openLoginModal() { document.getElementById('loginModal').style.display = 'flex'; }
        function handleFakeLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const pw = document.getElementById('loginPw').value.trim();
            if (!email || !pw) { showAlert("ì…ë ¥ ì˜¤ë¥˜", "ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }
            isLogged = true;
            closeModal('loginModal');
            document.getElementById('authArea').innerHTML = `<div class="flex items-center gap-3"><span class="text-sm font-bold text-gray-400">íˆ¬ììë‹˜</span><div class="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center text-white font-bold">ğŸ‘¤</div></div>`;
            document.getElementById('portfolioUserName').innerText = "íˆ¬ììë‹˜ì˜ ì¡°í•©";
            document.getElementById('portfolioUserIcon').classList.replace('bg-gray-800', 'bg-blue-500');
            showAlert("í™˜ì˜í•©ë‹ˆë‹¤!", "ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
        function showAlert(title, message) {
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertMessage').innerText = message;
            document.getElementById('alertModal').style.display = 'flex';
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function switchView(isDynamic) {
            document.getElementById('contentArea').style.display = isDynamic ? 'none' : 'block';
            document.getElementById('dynamicContainer').classList.toggle('hidden', !isDynamic);
            if(!isDynamic) window.scrollTo(0,0);
        }
        function updateNav(btn) {
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if(btn) btn.classList.add('active');
        }

        function loadMarketData(btn) {
            switchView(true); updateNav(btn);
            document.getElementById('sectionTitle').innerText = "Market Categories";
            document.getElementById('portfolioSidebar').classList.add('hidden');
            const categories = [
                { cat: "Market Wide", etf: "VTI, VOO, SPY", desc: "ì „ì²´ ì‹œì¥ ì§€ìˆ˜ ì¶”ì¢…", color: "blue" },
                { cat: "Sector", etf: "XLK, XLV, XLE", desc: "IT, ë°”ì´ì˜¤, ì—ë„ˆì§€ ë“±", color: "purple" },
                { cat: "Style", etf: "VUG, VTV, SCHD", desc: "ì„±ì¥/ê°€ì¹˜/ë°°ë‹¹ ì „ëµ", color: "orange" },
                { cat: "Theme", etf: "SOXX, AIQ, ARKK", desc: "ë¯¸ë˜ ê¸°ìˆ  ë° íŠ¸ë Œë“œ", color: "green" },
                { cat: "Defense", etf: "BND, TLT, SGOV", desc: "ì•ˆì •ì ì¸ ì±„ê¶Œ ìœ„ì£¼", color: "gray" }
            ];
            document.getElementById('etfGrid').innerHTML = categories.map(item => `<div class="info-card !p-8 cursor-pointer" onclick="showMarketDetail('${item.cat}')"><span class="text-[10px] font-bold text-white bg-${item.color}-500 px-2.5 py-1 rounded-lg uppercase">${item.cat}</span><h3 class="text-2xl font-black mt-5">${item.etf}</h3><p class="text-sm text-[var(--text-sub)] mt-3">${item.desc}</p></div>`).join('');
        }

        function loadData(menu, btn) {
    // 1. ê¸°ì¡´ í™”ë©´ ì´ˆê¸°í™”
    switchView(true); 
    updateNav(btn);
    document.getElementById('sectionTitle').innerText = menu;
    
    // 2. ê·¸ë¦¬ë“œ ë¹„ìš°ê¸° (HOT í™”ë©´ ì”ìƒ ì œê±°)
    const mainGrid = document.getElementById('etfGrid');
    if (mainGrid) mainGrid.innerHTML = ""; 

    // 3. í¬íŠ¸í´ë¦¬ì˜¤ ëª¨ë“œ ì„¤ì •
    const isPortfolioMode = (menu === 'í¬íŠ¸í´ë¦¬ì˜¤');
    const sidebar = document.getElementById('portfolioSidebar');
    if (sidebar) sidebar.classList.toggle('hidden', !isPortfolioMode);

    // 4. í™”ë©´ ì „í™˜ ë¡œì§
    if (isPortfolioMode) {
        // í¬íŠ¸í´ë¦¬ì˜¤ í´ë¦­ ì‹œ ìƒì„¸ ì˜ì—­ í˜¸ì¶œ
        showMarketDetail('Market Wide');
    } else {
        // ë‹¤ë¥¸ ë©”ë‰´(NEW ë“±) í´ë¦­ ì‹œ ë©”ì¸ ê·¸ë¦¬ë“œ ë¡œë“œ
        loadMarketData(btn);
    }
}

// [ê°œì„ ëœ ë¡œì§] ìƒì„¸ ë°ì´í„° í˜¸ì¶œ ì‹œ í™”ë©´ ì˜ì—­ì„ ëª…í™•íˆ ì œì–´
async function showMarketDetail(category) {
    const area = document.getElementById('marketDetailArea');
    const grid = document.getElementById('marketEtfGrid');
    const mainGrid = document.getElementById('etfGrid');

    // ë©”ì¸ ê·¸ë¦¬ë“œëŠ” ìˆ¨ê¸°ê³  ìƒì„¸ ì˜ì—­ì€ ë³´ì´ê²Œ ì„¤ì •
    if (mainGrid) mainGrid.innerHTML = ""; 
    if (area) area.style.display = 'block';
    
    document.getElementById('selectedCatTitle').innerText = category;
    const tickers = CATEGORY_MAP[category] || CATEGORY_MAP["Market Wide"];

    grid.innerHTML = '<div class="col-span-full text-center py-10 text-gray-500 animate-pulse">ì‹¤ì‹œê°„ ì‹œì„¸ ì—°ê²° ì¤‘...</div>';

    const FINNHUB_KEY = "csqv001r01qh09me9300csqv001r01qh09me930g";

    try {
        const results = await Promise.all(
            tickers.map(async (ticker) => {
                try {
                    // 1ï¸âƒ£ Finnhub (ì‹¤ì‹œê°„)
                    const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${ticker}&token=${FINNHUB_KEY}`);
                    const data = await res.json();
                    if (data && typeof data.dp === "number") return { ticker, yield: data.dp };
                    throw new Error("Finnhub invalid");
                } catch {
                    try {
                        // 2ï¸âƒ£ Yahoo Finance
                        const yRes = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&range=5d`);
                        const yData = await yRes.json();
                        const prices = yData.chart.result[0].indicators.quote[0].close;
                        const last = prices[prices.length - 1];
                        const prev = prices[prices.length - 2];
                        return { ticker, yield: ((last - prev) / prev) * 100 };
                    } catch {
                        // 3ï¸âƒ£ Fallback
                        return { ticker, yield: Number((Math.random() * 2 - 1).toFixed(2)) };
                    }
                }
            })
        );

        grid.innerHTML = results.map(({ ticker, yield }) => {
            const realYield = Number(yield).toFixed(2);
            tickerYields[ticker] = realYield;
            const isPositive = realYield >= 0;
            return `
                <div class="etf-pill" draggable="true" ondragstart="handleDragStart(event, '${ticker}')" onclick="openEtfDetail('${ticker}')">
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-[10px] text-gray-500 font-bold tracking-tighter uppercase">Live Data</span>
                        <span class="text-[10px] text-[#3182f6] font-bold">DETAIL ğŸ”</span>
                    </div>
                    <h4 class="font-bold text-white text-lg">${ticker}</h4>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-[10px] text-gray-500 font-medium">Day Change</span>
                        <span class="font-black ${isPositive ? 'text-[#3182f6]' : 'text-red-500'} text-lg">
                            ${isPositive ? '+' : ''}${realYield}%
                        </span>
                    </div>
                </div>`;
        }).join('');

    } catch (e) {
        console.error(e);
        grid.innerHTML = '<div class="col-span-full text-center py-10 text-red-400 text-sm">ì‹œì„¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
    }
}

        function handleDragStart(e, ticker) { e.dataTransfer.setData("ticker", ticker); e.target.style.opacity = "0.5"; }
        function handleDragOver(e) { e.preventDefault(); document.getElementById('dropZone').classList.add('drag-over'); }
        function handleDragLeave(e) { document.getElementById('dropZone').classList.remove('drag-over'); }
        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('dropZone').classList.remove('drag-over');
            const ticker = e.dataTransfer.getData("ticker");
            if (ticker && !myPortfolio.some(item => item.ticker === ticker)) {
                myPortfolio.push({ ticker: ticker, weight: 0 });
                rebalanceWeights();
                updatePortfolioUI();
            }
        }
        function rebalanceWeights() {
            if (myPortfolio.length === 0) return;
            const equalWeight = Math.floor(100 / myPortfolio.length);
            myPortfolio.forEach((item, index) => { item.weight = (index === myPortfolio.length - 1) ? (100 - (equalWeight * (myPortfolio.length - 1))) : equalWeight; });
        }
        function updateWeight(ticker, newWeight) {
            const item = myPortfolio.find(i => i.ticker === ticker);
            if (item) { item.weight = parseInt(newWeight); document.getElementById(`val-${ticker}`).innerText = `${newWeight}%`; checkWeightSum(); }
        }
        function checkWeightSum() {
            const sum = myPortfolio.reduce((acc, cur) => acc + cur.weight, 0);
            const warning = document.getElementById('weightWarning');
            if (sum !== 100) { warning.innerText = `í˜„ì¬ ë¹„ì¤‘ í•©ê³„: ${sum}% (100%ë¥¼ ë§ì¶°ì£¼ì„¸ìš”)`; warning.classList.remove('hidden'); } else { warning.classList.add('hidden'); }
            return sum === 100;
        }
        function updatePortfolioUI() {
            const listArea = document.getElementById('portfolioList');
            if (myPortfolio.length === 0) { listArea.innerHTML = `<div id="emptyMessage" class="h-40 flex items-center justify-center text-gray-600 border border-dashed border-gray-800 rounded-2xl">ë¹„ì–´ ìˆìŒ</div>`; document.getElementById('weightWarning').classList.add('hidden'); return; }
            listArea.innerHTML = myPortfolio.map(item => `<div class="selected-item"><div class="flex justify-between items-center mb-3"><span class="font-bold text-white text-sm">${item.ticker}</span><div class="flex items-center gap-3"><span id="val-${item.ticker}" class="text-[#3182f6] font-bold text-xs">${item.weight}%</span><button onclick="removeTicker('${item.ticker}')" class="text-gray-500 hover:text-white transition-colors text-xs">âœ•</button></div></div><input type="range" min="0" max="100" value="${item.weight}" class="weight-slider" oninput="updateWeight('${item.ticker}', this.value)"></div>`).join('');
            checkWeightSum();
        }
        function removeTicker(ticker) { myPortfolio = myPortfolio.filter(item => item.ticker !== ticker); rebalanceWeights(); updatePortfolioUI(); }
        function showFinalAnalysis() {
    if (!isLogged) { openLoginModal(); return; }
    if (myPortfolio.length === 0) { showAlert("ì¢…ëª© ì—†ìŒ", "í¬íŠ¸í´ë¦¬ì˜¤ì— ë‹´ê¸´ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
    if (!checkWeightSum()) { showAlert("ë¹„ì¤‘ ë¶ˆì¼ì¹˜", "ë¹„ì¤‘ì˜ í•©ì´ 100%ì—¬ì•¼ ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }

    let totalWeightedYield = 0;
    myPortfolio.forEach(item => {
        // [ì¤‘ìš”] íŒì—…ì—ì„œ ë¶ˆëŸ¬ì˜¨ 12ê°œì›” ìˆ˜ìµë¥  ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ë„ë¡ ìˆ˜ì •
        // tickerYields[item.ticker] ê°’ì´ ì—†ë‹¤ë©´ 0ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
        const currentYield = parseFloat(tickerYields[item.ticker] || 0);
        totalWeightedYield += (currentYield * (item.weight / 100));
    });

    const resYieldEl = document.getElementById('resYield');
    resYieldEl.innerText = (totalWeightedYield >= 0 ? '+' : '') + totalWeightedYield.toFixed(2) + '%';
    resYieldEl.style.color = totalWeightedYield >= 0 ? '#3182f6' : '#ef4444';

    const predict = (months) => {
        const expected = (totalWeightedYield / 12) * months;
        return (expected >= 0 ? '+' : '') + expected.toFixed(2) + '%';
    };

    document.getElementById('ai3m').innerText = predict(3);
    document.getElementById('ai6m').innerText = predict(6);
    document.getElementById('ai12m').innerText = predict(12);

    document.getElementById('analysisModal').style.display = 'flex';
}
        function closeMarketDetail() { document.getElementById('marketDetailArea').style.display = 'none'; }
        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        document.addEventListener('DOMContentLoaded', () => { switchView(false); });
        async function openEtfDetail(ticker) {
    const modal = document.getElementById('etfDetailModal');
    const loader = document.getElementById('modalLoading');
    
    if (!modal) {
        console.error("íŒì—…ì°½(etfDetailModal)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTMLì— IDê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
        return;
    }

    document.getElementById('detailTicker').innerText = ticker;
    modal.style.display = 'flex'; // ì¼ë‹¨ íŒì—…ë¶€í„° ë„ì›ë‹ˆë‹¤.
    if (loader) loader.style.display = 'flex';

    try {
        // ë³´ì•ˆ ì´ìŠˆ(CORS)ë¥¼ í”¼í•˜ê¸° ìœ„í•´ allorigins í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const targetUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&range=1y`;
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;
        
        const response = await fetch(proxyUrl);
        const json = await response.json();
        const data = JSON.parse(json.contents);
        
        const result = data.chart.result[0];
        const prices = result.indicators.quote[0].close.filter(p => p !== null); // ë°ì´í„° ì •ì œ
        const currentPrice = prices[prices.length - 1];

        const getReturn = (daysAgo) => {
            const pastPrice = prices[prices.length - 1 - daysAgo] || prices[0];
            const yieldVal = ((currentPrice - pastPrice) / pastPrice) * 100;
            const isPos = yieldVal >= 0;
            return {
                text: (isPos ? '+' : '') + yieldVal.toFixed(2) + '%',
                color: isPos ? '#3182f6' : '#ef4444'
            };
        };

        const periods = {
            m1: getReturn(20),
            m3: getReturn(60),
            m6: getReturn(120),
            m12: getReturn(prices.length - 1)
        };
        tickerYields[ticker] = parseFloat(periods.m12.text);

        ['m1', 'm3', 'm6', 'm12'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.innerText = periods[id].text;
                el.style.color = periods[id].color;
            }
        });
    } catch (error) {
        console.error("ë°ì´í„° ë¡œë“œ ì—ëŸ¬:", error);
        // ì—ëŸ¬ ì‹œ 0%ë¡œ ì´ˆê¸°í™”
        ['m1', 'm3', 'm6', 'm12'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.innerText = "ë°ì´í„° ì—†ìŒ";
        });
    } finally {
        if (loader) loader.style.display = 'none';
    }
}
// ì‹¤ì œ ê³¼ê±° ìˆ˜ìµë¥ ì„ ê°€ì ¸ì™€ì„œ íŒì—…ì„ ë„ìš°ëŠ” í•¨ìˆ˜
let myChart = null; // ì°¨íŠ¸ ê°ì²´ ì €ì¥ìš© ë³€ìˆ˜

async function openEtfDetail(ticker) {
    const modal = document.getElementById('etfDetailModal');
    const loader = document.getElementById('modalLoading');
    
    document.getElementById('detailTicker').innerText = ticker;
    modal.style.display = 'flex';
    if (loader) loader.style.display = 'flex';

    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&range=1y`;
    const proxyList = [
        `https://corsproxy.io/?${encodeURIComponent(yahooUrl)}`,
        `https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`,
        `https://api.codetabs.com/v1/proxy/?quest=${encodeURIComponent(yahooUrl)}`
    ];

    let success = false;

    for (let url of proxyList) {
        if (success) break;
        try {
            const response = await fetch(url);
            const rawData = await response.json();
            const data = rawData.contents ? JSON.parse(rawData.contents) : rawData;

            if (data.chart && data.chart.result) {
                const result = data.chart.result[0];
                const timestamps = result.timestamp;
                const prices = result.indicators.quote[0].close.filter(p => p !== null);
                
                // 1. ìˆ˜ìµë¥  ìˆ˜ì¹˜ ê³„ì‚° ë° UI ë°˜ì˜
                const currentPrice = prices[prices.length - 1];
                const calc = (pastPrice) => {
                    const yieldVal = ((currentPrice - pastPrice) / pastPrice) * 100;
                    return { text: (yieldVal >= 0 ? '+' : '') + yieldVal.toFixed(2) + '%', color: yieldVal >= 0 ? '#3182f6' : '#ef4444' };
                };

                const res = {
                    m1: calc(prices[prices.length - 21] || prices[0]),
                    m3: calc(prices[prices.length - 61] || prices[0]), // 3ê°œì›”(ì•½ 60ê±°ë˜ì¼) ì¶”ê°€
                    m6: calc(prices[prices.length - 121] || prices[0]), // 6ê°œì›”(ì•½ 120ê±°ë˜ì¼) ì¶”ê°€
                    m12: calc(prices[0])
                };
                
                // ë¶„ì„ì°½ ì—°ë™ì„ ìœ„í•´ 12ê°œì›” ìˆ˜ìµë¥  ì €ì¥
                tickerYields[ticker] = parseFloat(res.m12.text);

                // ğŸš€ ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•©ë‹ˆë‹¤! m3, m6ë¥¼ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ì„¸ìš”.
                ['m1', 'm3', 'm6', 'm12'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.innerText = res[id].text;
                        el.style.color = res[id].color;
                    }
                });
                
                // ë¶„ì„ì°½ ì—°ë™ì„ ìœ„í•´ 12ê°œì›” ìˆ˜ìµë¥  ì €ì¥
                tickerYields[ticker] = parseFloat(res.m12.text);

                document.getElementById('m1').innerText = res.m1.text;
                document.getElementById('m12').innerText = res.m12.text;

                // 2. ê·¸ë˜í”„ ê·¸ë¦¬ê¸° (Chart.js)
                const ctx = document.getElementById('etfChart').getContext('2d');
                if (myChart) myChart.destroy(); // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ

                myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: prices.map((_, i) => i), // Xì¶• (ë‚ ì§œ ìƒëµ)
                        datasets: [{
                            label: 'Price Flow (1Y)',
                            data: prices,
                            borderColor: '#3182f6',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: true,
                            backgroundColor: 'rgba(49, 130, 246, 0.1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { display: false }, y: { grid: { color: '#2c2c2e' } } }
                    }
                });

                success = true;
            }
        } catch (e) { console.error("ì„œë²„ ì‹œë„ ì¤‘..."); }
    }

    if (loader) loader.style.display = 'none';
}
// í‹°ì»¤ ê²€ìƒ‰ ë° í¬íŠ¸í´ë¦¬ì˜¤ ì¦‰ì‹œ ì¶”ê°€ í•¨ìˆ˜
async function showTrend(type) {
    const grid = document.getElementById('etfGrid');
    const title = document.getElementById('sectionTitle');
    
    title.innerText = type === 'NEW' ? "Recently Launched (NEW)" : "Top Performance (HOT)";
    grid.innerHTML = `<div class="col-span-full text-center py-20">ë°ì´í„° ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>`;

    // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì˜ í‹°ì»¤ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹¨ (ì¤‘ë³µ ì œê±°)
    const allTickers = [...new Set(Object.values(CATEGORY_MAP).flat())];
    const trendData = [];

    // ì§„í–‰ ìƒí™©ì„ ìœ„í•´ í•˜ë‚˜ì”© ë¶ˆëŸ¬ì˜´
    for (const ticker of allTickers) {
        try {
            const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1mo&range=1y`;
            const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(yahooUrl)}`;
            const response = await fetch(proxyUrl);
            const data = await response.json();

            if (data.chart && data.chart.result) {
                const result = data.chart.result[0];
                const prices = result.indicators.quote[0].close.filter(p => p !== null);
                const timestamps = result.timestamp;
                
                // 1. ìˆ˜ìµë¥  ê³„ì‚° (ìµœê·¼ 3ê°œì›” ë“±ë½ë¥ )
                const currentPrice = prices[prices.length - 1];
                const threeMonthsAgoPrice = prices[prices.length - 4] || prices[0]; // ì›”ë´‰ ê¸°ì¤€ 3-4ê°œ ì „
                const yield3m = ((currentPrice - threeMonthsAgoPrice) / threeMonthsAgoPrice) * 100;

                // 2. ìƒì¥ì¼ ì²´í¬ (ë°ì´í„°ê°€ 3ê°œì›”ì¹˜ ì´í•˜ë¡œë§Œ ì¡´ì¬í•˜ë©´ NEWë¡œ ê°„ì£¼)
                const isNew = timestamps.length <= 4; 

                trendData.push({ 
                    ticker, 
                    yield3m, 
                    isNew,
                    name: ticker // ì´ë¦„ ë°ì´í„°ê°€ ë”°ë¡œ ì—†ë‹¤ë©´ í‹°ì»¤ë¡œ í‘œì‹œ
                });
            }
        } catch (e) { console.warn(`${ticker} ë¶„ì„ ê±´ë„ˆëœ€`); }
    }

    // ë°ì´í„° ì •ë ¬
    let resultList = [];
    if (type === 'HOT') {
        // ìˆ˜ìµë¥  ë†’ì€ ìˆœìœ¼ë¡œ ìƒìœ„ 12ê°œ
        resultList = trendData.sort((a, b) => b.yield3m - a.yield3m).slice(0, 12);
    } else {
        // ìƒì¥ëœ ì§€ ì–¼ë§ˆ ì•ˆ ëœ ì¢…ëª©ë“¤ (ì´ ë°ì´í„°ëŠ” API íŠ¹ì„±ìƒ ì œí•œì ì¼ ìˆ˜ ìˆìŒ)
        resultList = trendData.filter(d => d.isNew).slice(0, 12);
        if (resultList.length === 0) {
            // NEW ë°ì´í„°ê°€ ë¶€ì¡±í•  ê²½ìš° ìµœê·¼ ìˆ˜ìµë¥  ë³€ë™ì´ ê°€ì¥ ë‹¤ì´ë‚´ë¯¹í•œ ì¢…ëª©ìœ¼ë¡œ ëŒ€ì²´
            resultList = trendData.sort((a, b) => Math.abs(b.yield3m) - Math.abs(a.yield3m)).slice(0, 8);
        }
    }

    // í™”ë©´ ê·¸ë¦¬ê¸°
    grid.innerHTML = "";
    resultList.forEach(item => {
        const card = document.createElement('div');
        card.className = "bg-[#1c1c1e] p-8 rounded-[32px] border border-[#2c2c2e] hover:border-[#3182f6] transition-all cursor-pointer group";
        card.onclick = () => openEtfDetail(item.ticker);
        card.innerHTML = `
            <div class="flex justify-between items-start mb-6">
                <span class="px-4 py-1.5 rounded-full text-[11px] font-bold tracking-wider bg-[#3182f6]/10 text-[#3182f6] uppercase">${type}</span>
                <span class="text-2xl font-bold ${item.yield3m >= 0 ? 'text-[#3182f6]' : 'text-[#ef4444]'}">
                    ${item.yield3m >= 0 ? '+' : ''}${item.yield3m.toFixed(2)}%
                </span>
            </div>
            <h3 class="text-3xl font-bold mb-2 group-hover:text-[#3182f6] transition-colors">${item.ticker}</h3>
            <p class="text-gray-500 text-sm">3-Month Performance</p>
        `;
        grid.appendChild(card);
    });
}
// 2. ë°°ë‹¹ ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
function initDividendData() {
    const mockData = {
        "JEPI": "7.25", "JEPQ": "9.12", "QYLD": "11.85", "XYLD": "8.52",
        "O": "5.41", "MAIN": "6.10", "SCHD": "3.45", "VYM": "2.98",
        "DIA": "1.82", "DGRW": "2.15", "VIG": "1.95", "DVY": "3.75",
        "SDY": "2.60", "DGRO": "2.35", "VXUS": "3.20", "BNDX": "4.10"
    };
    for (let ticker in mockData) {
        tickerDividends[ticker] = mockData[ticker];
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
initDividendData();
    </script>
</body>
</html>